<?xml version="1.0" encoding="UTF-8"?>
<!--

    /**
     * Copyright 2010 Västra Götalandsregionen
     *
     *   This library is free software; you can redistribute it and/or modify
     *   it under the terms of version 2.1 of the GNU Lesser General Public
     *   License as published by the Free Software Foundation.
     *
     *   This library is distributed in the hope that it will be useful,
     *   but WITHOUT ANY WARRANTY; without even the implied warranty of
     *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
     *   GNU Lesser General Public License for more details.
     *
     *   You should have received a copy of the GNU Lesser General Public
     *   License along with this library; if not, write to the
     *   Free Software Foundation, Inc., 59 Temple Place, Suite 330,
     *   Boston, MA 02111-1307  USA
     *
     */

-->

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:task="http://www.springframework.org/schema/task"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context
                           http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/task
                           http://www.springframework.org/schema/task/spring-task.xsd
                           http://www.springframework.org/schema/tx
                           http://www.springframework.org/schema/tx/spring-tx.xsd">

	<context:annotation-config />
	<tx:annotation-driven />

 	<bean id="retrieveQueue"
		class="java.util.concurrent.LinkedBlockingQueue" >
	</bean>

 	<bean id="distributionQueue"
		class="java.util.concurrent.LinkedBlockingQueue">
	</bean>

	<bean id="feedRepository" class="se.vgregion.push.repository.jpa.JpaFeedRepository"  />
	<bean id="subscriptionRepository" class="se.vgregion.push.repository.jpa.JpaSubscriptionRepository" />

 	<bean id="pushService"
		class="se.vgregion.push.services.DefaultPushService">
		<constructor-arg ref="subscriptionRepository" />
		<constructor-arg ref="feedRepository" />
	</bean>

 	<bean id="feedDistributor"
		class="se.vgregion.push.services.FeedDistributor"
		init-method="start"
		destroy-method="stop">
		<constructor-arg ref="distributionQueue" />
		<constructor-arg ref="pushService" />
	</bean>


 	<bean id="feedRetriver"
		class="se.vgregion.push.services.FeedRetriever"
		init-method="start"
		destroy-method="stop">
		<constructor-arg ref="retrieveQueue" />
		<constructor-arg ref="distributionQueue" />
		<constructor-arg ref="pushService" />
	</bean>

	<bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager">
		<property name="entityManagerFactory" ref="entityManagerFactory" />
	</bean>

</beans>